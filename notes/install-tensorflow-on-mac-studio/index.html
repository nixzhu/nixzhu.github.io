<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="NIX ZHU"/><link rel="canonical" href="https://nixzhu.dev/notes/install-tensorflow-on-mac-studio"/><meta name="twitter:url" content="https://nixzhu.dev/notes/install-tensorflow-on-mac-studio"/><meta name="og:url" content="https://nixzhu.dev/notes/install-tensorflow-on-mac-studio"/><title>在 Mac Studio 上安装 TensorFlow | NIX ZHU</title><meta name="twitter:title" content="在 Mac Studio 上安装 TensorFlow | NIX ZHU"/><meta name="og:title" content="在 Mac Studio 上安装 TensorFlow | NIX ZHU"/><meta name="description" content="对于 M1 芯片的 Mac，安装具有 GPU（Metal）支持的 TensorFlow"/><meta name="twitter:description" content="对于 M1 芯片的 Mac，安装具有 GPU（Metal）支持的 TensorFlow"/><meta name="og:description" content="对于 M1 芯片的 Mac，安装具有 GPU（Metal）支持的 TensorFlow"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to NIX ZHU"/></head><body class="item-page"><header><div class="wrapper"><a href="/" class="site-name">NIX ZHU</a><nav><ul><li><a href="/posts">Posts</a></li><li><a href="/notes" class="selected">Notes</a></li><li><a href="/apps">Apps</a></li><li><a href="/about">About</a></li></ul></nav></div></header><div class="wrapper"><article><div class="date">2022/5/6</div><div class="content"><h1>在 Mac Studio 上安装 TensorFlow</h1><p>环境 macOS 12.3.1，M1 Ultra 芯片，已经安装好 Homebrew</p><p>此前试过<a href="https://www.tensorflow.org/install">官网</a>提供的安装方式，但失败，因此再试试第三方的安装方式</p><p>本文的主要流程参考自 <a href="https://sudhanva.me/install-tensorflow-on-apple-m1-pro-max/">Install TensorFlow on Apple M1 (M1, Pro, Max) with GPU (Metal)</a>，根据遇到的问题对步骤进行了调整</p><p>先安装 <a href="https://github.com/conda-forge/miniforge">miniforge</a>（它提供 <strong>conda</strong> 作为后续的 Python 环境管理工具）：</p><pre><code>brew install miniforge</code></pre><p>然后配置当前 Shell（我使用 <strong>zsh</strong>）：</p><pre><code>conda init zsh</code></pre><p>输出类似如下：</p><pre><code>no change     /opt/homebrew/Caskroom/miniforge/base/condabin/conda
……
modified      /Users/nix/.zshrc

==&gt; For changes to take effect, close and re-open your current shell. &lt;==
</code></pre><p>看起来只修改了<strong>~/.zshrc</strong>（你可自行查看此文件的改动）</p><p>按提示，我们开一个新的 Shell 窗口</p><p>此时会看到 <strong>(base)</strong> 开头的提示符（<strong>~/.zshrc</strong> 里面新加代码的功劳），然后我们创建一个新的 conda 环境（独立的环境便于隔离，后续安装的包只会在这个环境里生效）：</p><pre><code>conda create --name <span class="hljs-built_in">test</span> python=3.9</code></pre><p>这个环境的名字是 <strong>test</strong>（可换成你喜欢的），而且指定使用 Python <strong>3.9</strong>，不然可能安装成最新的 Python <strong>3.10</strong>，因为目前 <a href="https://www.tensorflow.org/install">TensorFlow 2 只支持 Python 3.6-3.9</a>，如果支持的版本有所变动，可自行调整</p><p>接着，我们激活 test 环境：</p><pre><code>conda activate <span class="hljs-built_in">test</span></code></pre><p>这时候应该能看到 <strong>(test)</strong> 开头的提示符</p><p>然后在此环境安装 Apple 的 TensorFlow 依赖：</p><pre><code>conda install -c apple tensorflow-deps</code></pre><p>以及 Apple 给 TensorFlow 提供的 Metal GPU API：</p><pre><code>pip install tensorflow-metal</code></pre><p>最后安装 macOS arm64 版本的 TensorFlow：</p><pre><code>pip install tensorflow-macos</code></pre><p>最后我们来测试一下。先进入 Python 交互环境：</p><pre><code>python
</code></pre><p>然后导入 tensorflow（可能需要等待一会儿），看看其版本，以及 CPU/GPU 的情况：</p><pre><code><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;TensorFlow version:&quot;</span>, tf.__version__)
TensorFlow version: <span class="hljs-number">2.8</span><span class="hljs-number">.0</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Num CPUs Available: &quot;</span>, <span class="hljs-built_in">len</span>(tf.config.experimental.list_physical_devices(<span class="hljs-string">&#x27;CPU&#x27;</span>)))
Num CPUs Available:  <span class="hljs-number">1</span>
<span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Num GPUs Available: &quot;</span>, <span class="hljs-built_in">len</span>(tf.config.experimental.list_physical_devices(<span class="hljs-string">&#x27;GPU&#x27;</span>)))
Num GPUs Available:  <span class="hljs-number">1</span>
<span class="hljs-meta">&gt;&gt;&gt; </span></code></pre><p>看起来 CPU 和 GPU 各有一个</p><p>用 <strong>Ctrl + D</strong> 退出 Python 交互环境后，可用如下命令停用 test 环境：</p><pre><code>conda deactivate</code></pre><p>又会看到 <strong>(base)</strong> 开头的提示符</p><p>之后若想再使用 test 环境，依然是使用如下命令激活：</p><pre><code>conda activate <span class="hljs-built_in">test</span></code></pre></div><ul class="tag-list"><li><a href="/tags/mac">Mac</a></li><li><a href="/tags/m1">M1</a></li><li><a href="/tags/tensorflow">TensorFlow</a></li><li><a href="/tags/metal">Metal</a></li></ul></article></div><footer><p>Copyright © <a href="https://mastodon.social/@nixzhu" rel="me">nixzhu</a>. All rights reserved.</p><p></p><p><a href="/feed.rss">RSS feed</a></p></footer></body></html>